<VirtualHost *:443>
    # INSTRUCTIONS
    # This is a conf file to use for a reverse proxy on Apache2 back to your Guacamole server so it can be accessed from the internet.
    # Your Guacamole server should already be functional and accessible via http://192.168.1.243:8080
    # You will probably need to install a bunch of modules in your Apache2 server. Google or AI are your friends here as I can't remember which ones I installed.
    # You need a public DNS entry guac.yourdomain.com pointing to your fixed IP address, ports 80 and 443 forwarded on your router to your Apache2 server.
    # First create the LetsEncrypt Certbot certiticate with: certbot certonly --webroot -w /var/www/html -d guac.yourdomain.com
    # Certificates will be created in /etc/letsencrypt/live/guac.yourdomain.com/
    # Then enable your site: a2ensite guac.yourdomain.com.conf
    # Run systemctl reload apache2
    # Test https://guac.yourdomain.com (from the LAN and from the Internet)
    #
    ServerName guac.yourdomain.com

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/guac.yourdomain.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/guac.yourdomain.com/privkey.pem

    # Modern SSL configuration
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite HIGH:!aNULL:!MD5
    SSLHonorCipherOrder on

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/guacamole-error.log
    CustomLog ${APACHE_LOG_DIR}/guacamole-access.log combined

    # WebSocket Support - must come before ProxyPass
    # Make sure to use the correct IP address and port of your guacamole server (192.168.1.243, 8080)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/(.*) ws://192.168.1.243:8080/$1 [P,L]

    # Reverse Proxy Configuration
    ProxyPreserveHost On
    ProxyPass / http://192.168.1.243:8080/
    ProxyPassReverse / http://192.168.1.243:8080/

    # Optional: Timeout settings if your backend is slow
    ProxyTimeout 300
</VirtualHost>
